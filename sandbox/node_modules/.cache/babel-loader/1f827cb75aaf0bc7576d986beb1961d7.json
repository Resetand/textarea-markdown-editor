{"ast":null,"code":"var __makeTemplateObject = this && this.__makeTemplateObject || function (cooked, raw) {\n  if (Object.defineProperty) {\n    Object.defineProperty(cooked, \"raw\", {\n      value: raw\n    });\n  } else {\n    cooked.raw = raw;\n  }\n\n  return cooked;\n};\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { clamp, escapeRegExp, getClipboardText } from \"./utils\";\nimport { Cursor } from \"./Cursor\"; // eslint-disable-next-line no-useless-escape\n\nvar ANY_URL_RE = /(https?|ftp):\\/\\/(-\\.)?([^\\s/?\\.#-]+\\.?)+(\\/[^\\s]*)?$/i;\nvar ANY_LIST_RE = /^(\\s*(-|\\*|(\\d\\.){1,2})\\s+)(.+)/;\nvar ANY_BLANK_LIST_RE = /^(\\s*(-|\\*|(\\d\\.){1,2})\\s{0,1})$/;\nvar INDENT_SPACE_SIZE = 4;\nexport var mapCurrentLine = function (element, mapper) {\n  var cursor = new Cursor(element);\n  var currentLine = cursor.getLine();\n  var mappedLine = mapper(currentLine);\n  cursor.spliceContent(Cursor.raw(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\", \"\", \"\"], [\"\", \"\", \"\"])), mappedLine, Cursor.$), {\n    replaceCount: 1\n  });\n};\n/**\n * Wraps the current selection in markup within the current line\n * or removes markup if target is already wrapped (with useUnwrapping = true)\n */\n\nexport var singleLineWrapper = function (_a) {\n  var element = _a.element,\n      markup = _a.markup,\n      _b = _a.useUnwrapping,\n      useUnwrapping = _b === void 0 ? true : _b,\n      _c = _a.placeholder,\n      placeholder = _c === void 0 ? \"\" : _c;\n  var cursor = new Cursor(element);\n  var position = cursor.getCurrentPosition();\n  var selected = cursor.getSelected().split(\"\\n\")[0];\n  var currentLine = cursor.getLine();\n\n  if (!selected) {\n    var before_1 = currentLine.slice(0, position.lineSelectionStart);\n    var after_1 = currentLine.slice(position.lineSelectionStart);\n    var raw_1 = Cursor.raw(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"])), before_1, markup, Cursor.$, placeholder, Cursor.$, markup, after_1);\n    cursor.spliceContent(raw_1, {\n      replaceCount: 1\n    });\n    return;\n  }\n\n  var clumpLine = function (value) {\n    return clamp(value, 0, currentLine.length);\n  };\n\n  var start = position.lineSelectionStart;\n  var end = position.lineSelectionEnd;\n  var needUnwrap = useUnwrapping && currentLine && isTargetAlreadyWrapped(element, markup);\n  var before = currentLine.slice(0, clumpLine(start + (needUnwrap ? -markup.length : 0)));\n  var after = currentLine.slice(clumpLine(end + (needUnwrap ? markup.length : 0)));\n  var onDemandMarkup = needUnwrap ? \"\" : markup;\n  var content = selected || placeholder;\n  var raw = Cursor.raw(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"])), before, onDemandMarkup, Cursor.$, content, Cursor.$, onDemandMarkup, after);\n  cursor.spliceContent(raw, {\n    replaceCount: 1\n  });\n};\nexport var linkCommandHandler = function (ctx) {\n  // Create a cursor instance it will be the our\n  // core-service for manipulations with textarea\n  var cursor = new Cursor(ctx.element); // Getting range of selection for current line\n\n  var _a = cursor.getCurrentPosition(),\n      lineSelectionStart = _a.lineSelectionStart,\n      lineSelectionEnd = _a.lineSelectionEnd; // Getting the current line\n\n\n  var currentLine = cursor.getLine(); // Getting the current selected text\n\n  var selected = currentLine.slice(lineSelectionStart, lineSelectionEnd); // Slice text before and after selection\n\n  var after = currentLine.slice(0, lineSelectionStart);\n  var before = currentLine.slice(lineSelectionEnd);\n  var linkPlaceholder = \"example\";\n  var urlPlaceholder = \"url\";\n  var linkText = selected || linkPlaceholder; // Now we can build text for current line. in this tagged bellow template just a\n  // bunch of concatenated strings except \"Cursor.$\" - it is a special marker for\n  // showing selection range declarative, in this case we want to select the \"linkText\"\n\n  var raw = Cursor.raw(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"], [\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"])), before, Cursor.$, linkText, Cursor.$, urlPlaceholder, after); // Finally we can make \"spliceContent\" - this function receive \"raw\" result and\n  // options object, where you can specify start lineNumber and how many lines\n  // you need to replace (similar to Array.prototype.splice mechanic)\n  // in this case we need to start from current line (default) and replace 1 line\n  // which means just replace the current line\n\n  cursor.spliceContent(raw, {\n    replaceCount: 1\n  }); // -------------------------------------- PS ----------------------------------------\n  // You can use one or two \"Cursor.$\". One will show the position of the cursor\n  // with two you specify a selection range\n  // ----------------------------------------------------------------------------------\n};\n/**\n * Checks if target is wrapped in markup\n */\n\nvar isTargetAlreadyWrapped = function (element, markup) {\n  var cursor = new Cursor(element);\n  var currentLine = cursor.getLine();\n  var position = cursor.getCurrentPosition();\n\n  var clumpLine = function (value) {\n    return clamp(value, 0, currentLine.length);\n  };\n\n  var escapedMarkup = escapeRegExp(markup);\n  var offsettedTarget = currentLine.slice(clumpLine(position.lineSelectionStart - markup.length), clumpLine(position.lineSelectionEnd + markup.length));\n  var re = new RegExp(escapedMarkup + \".+\" + escapedMarkup, \"gi\");\n  return re.test(offsettedTarget);\n};\n\nexport var nextLineCommandHandler = function (ctx) {\n  var cursor = new Cursor(ctx.element);\n\n  var insertListPrefixOnDemand = function () {\n    var position = cursor.getCurrentPosition();\n    var prevLine = cursor.getLine(position.lineNumber - 1) || \"\";\n    var currentLine = cursor.getLine();\n    var listMatch = ANY_LIST_RE.exec(prevLine);\n\n    if (listMatch === null) {\n      return;\n    }\n\n    var prefix = listMatch[2];\n\n    var getNewLinePrefix = function () {\n      var increaseOrder = function () {\n        var splited = prefix.split(\".\");\n        splited[splited.length - 2] = String(parseInt(splited[splited.length - 2]) + 1);\n        return splited.join(\".\");\n      };\n\n      return (isNaN(parseFloat(prefix)) ? prefix : increaseOrder()).trimStart();\n    };\n\n    var indent = \" \".repeat(cursor.getIndentSize(position.lineNumber - 1));\n    var raw = Cursor.raw(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\", \"\", \" \", \"\", \"\"], [\"\", \"\", \" \", \"\", \"\"])), indent, getNewLinePrefix(), currentLine, Cursor.$);\n    cursor.spliceContent(raw, {\n      startLineNumber: position.lineNumber,\n      replaceCount: 1\n    });\n  }; // waiting enter default behaver will be handled\n\n\n  setTimeout(insertListPrefixOnDemand, 0);\n};\nexport var indentCommandHandler = function (_a) {\n  var element = _a.element,\n      keyEvent = _a.keyEvent,\n      options = _a.options;\n  var cursor = new Cursor(element);\n  keyEvent === null || keyEvent === void 0 ? void 0 : keyEvent.preventDefault();\n  var currentLine = cursor.getLine();\n  var listMatch = ANY_BLANK_LIST_RE.exec(currentLine);\n  var indent = \" \".repeat(INDENT_SPACE_SIZE + cursor.getIndentSize());\n\n  if (options.useIndentListPrefixTabulation && listMatch) {\n    var prefix = listMatch[2];\n    var newPrefix = !isNaN(parseFloat(prefix)) && prefix.split(\".\").length <= 2 ? prefix + \"1.\" : prefix;\n    cursor.spliceContent(Cursor.raw(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\", \"\", \" \", \"\"], [\"\", \"\", \" \", \"\"])), indent, newPrefix, Cursor.$), {\n      replaceCount: 1\n    });\n    return;\n  }\n\n  cursor.spliceContent(Cursor.raw(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\"])), currentLine, indent, Cursor.$), {\n    replaceCount: 1\n  });\n};\nexport var linkPasteCommandHandler = function (ctx) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var cursor, position, currentLine, isSelectedUrl, selected, isSelectedInLinkMarkup, pastedValue, before, after, raw;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          cursor = new Cursor(ctx.element);\n          position = cursor.getCurrentPosition();\n          currentLine = cursor.getLine(position.lineNumber);\n          isSelectedUrl = ANY_URL_RE.test(currentLine.slice(position.lineSelectionStart, position.lineSelectionEnd));\n          selected = cursor.getSelected();\n\n          isSelectedInLinkMarkup = function () {\n            var before = currentLine.slice(0, position.lineSelectionStart);\n            var after = currentLine.slice(position.lineSelectionEnd);\n            return /\\[.*\\]\\($/gi.test(before) && /^\\)/gi.test(after);\n          }();\n\n          if (!selected || !ctx.options.useLinkMarkupOnSelectionPasteUrl || isSelectedInLinkMarkup || isSelectedUrl) {\n            return [2\n            /*return*/\n            ];\n          }\n\n          return [4\n          /*yield*/\n          , getClipboardText().then(function (x) {\n            return x === null || x === void 0 ? void 0 : x.trim();\n          })];\n\n        case 1:\n          pastedValue = _a.sent();\n\n          if (!pastedValue || !ANY_URL_RE.test(pastedValue)) {\n            return [2\n            /*return*/\n            ];\n          }\n\n          before = currentLine.slice(0, position.lineSelectionStart);\n          after = currentLine.slice(position.lineSelectionEnd);\n          raw = Cursor.raw(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"], [\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"])), before, Cursor.$, selected, Cursor.$, pastedValue, after);\n          cursor.spliceContent(raw, {\n            replaceCount: 1\n          });\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\nexport var codeBlockCommandHandler = function (ctx) {\n  var cursor = new Cursor(ctx.element);\n  var position = cursor.getCurrentPosition();\n  var selected = cursor.getSelected();\n  var currentLine = cursor.getLine();\n  var markup = \"```\";\n\n  var isAlreadyWrapper = function () {\n    var beforeLine = cursor.getLine(position.lineNumber - 1);\n    var afterLine = cursor.getLine(position.lineNumberEnd + 1);\n    return selected && beforeLine === markup && afterLine === markup;\n  };\n\n  if (isAlreadyWrapper()) {\n    cursor.removeLines(position.lineNumber - 1, position.lineNumberEnd + 1);\n    return;\n  }\n\n  var prefix = currentLine && !selected ? \"\\n\" : \"\";\n  var content = selected || \"code block\";\n  var raw = Cursor.raw(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"\", \"\", \"\\n\", \"\", \"\", \"\\n\", \"\"], [\"\", \"\", \"\\\\n\", \"\", \"\", \"\\\\n\", \"\"])), prefix, markup, Cursor.$, content, Cursor.$, markup);\n  cursor.spliceContent(raw, {\n    replaceCount: selected.split(\"\\n\").length,\n    startLineNumber: position.lineNumber\n  });\n};\nexport var codeSelectedCommandHandler = function (ctx) {\n  var cursor = new Cursor(ctx.element);\n  var selected = cursor.getSelected();\n\n  if (selected === \"\") {\n    codeInlineCommandHandler(ctx);\n    return;\n  }\n\n  if (selected.includes(\"\\n\")) {\n    codeBlockCommandHandler(ctx);\n  } else {\n    codeInlineCommandHandler(ctx);\n  }\n};\nexport var boldCommandHandler = function (ctx) {\n  singleLineWrapper(__assign(__assign({}, ctx), {\n    placeholder: \"bold\",\n    markup: ctx.options.boldSyntax\n  }));\n};\nexport var italicCommandHandler = function (ctx) {\n  singleLineWrapper(__assign(__assign({}, ctx), {\n    placeholder: \"italic\",\n    markup: ctx.options.italicSyntax\n  }));\n};\nexport var createHeadlineCommandHandler = function (level) {\n  return function (ctx) {\n    var prefix = \"#\".repeat(clamp(level, 1, 6)) + \" \";\n    mapCurrentLine(ctx.element, function (line) {\n      return prefix + line.replace(/^#{0,6}\\s+/g, \"\");\n    });\n  };\n};\nexport var orderedListCommandHandler = function (ctx) {\n  mapCurrentLine(ctx.element, function (line) {\n    return \"1. \" + line;\n  });\n};\nexport var unorderedListCommandHandler = function (ctx) {\n  mapCurrentLine(ctx.element, function (line) {\n    return ctx.options.unorderedListSyntax + \" \" + line;\n  });\n};\nexport var blockQuotesCommandHandler = function (ctx) {\n  mapCurrentLine(ctx.element, function (line) {\n    return \"> \" + line;\n  });\n};\nexport var codeInlineCommandHandler = function (ctx) {\n  singleLineWrapper(__assign(__assign({}, ctx), {\n    placeholder: \"code\",\n    markup: \"`\"\n  }));\n};\nexport var strikeThroughCommandHandler = function (ctx) {\n  singleLineWrapper(__assign(__assign({}, ctx), {\n    placeholder: \"strike-through\",\n    markup: \"~~\"\n  }));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9;","map":{"version":3,"sources":["/Users/kamachekhin/code/markdown-textarea/dist/handlers.js"],"names":["__makeTemplateObject","cooked","raw","Object","defineProperty","value","__assign","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","clamp","escapeRegExp","getClipboardText","Cursor","ANY_URL_RE","ANY_LIST_RE","ANY_BLANK_LIST_RE","INDENT_SPACE_SIZE","mapCurrentLine","element","mapper","cursor","currentLine","getLine","mappedLine","spliceContent","templateObject_1","$","replaceCount","singleLineWrapper","_a","markup","_b","useUnwrapping","_c","placeholder","position","getCurrentPosition","selected","getSelected","split","before_1","slice","lineSelectionStart","after_1","raw_1","templateObject_2","clumpLine","start","end","lineSelectionEnd","needUnwrap","isTargetAlreadyWrapped","before","after","onDemandMarkup","content","templateObject_3","linkCommandHandler","ctx","linkPlaceholder","urlPlaceholder","linkText","templateObject_4","escapedMarkup","offsettedTarget","re","RegExp","test","nextLineCommandHandler","insertListPrefixOnDemand","prevLine","lineNumber","listMatch","exec","prefix","getNewLinePrefix","increaseOrder","splited","String","parseInt","join","isNaN","parseFloat","trimStart","indent","repeat","getIndentSize","templateObject_5","startLineNumber","setTimeout","indentCommandHandler","keyEvent","options","preventDefault","useIndentListPrefixTabulation","newPrefix","templateObject_6","templateObject_7","linkPasteCommandHandler","isSelectedUrl","isSelectedInLinkMarkup","pastedValue","useLinkMarkupOnSelectionPasteUrl","x","trim","templateObject_8","codeBlockCommandHandler","isAlreadyWrapper","beforeLine","afterLine","lineNumberEnd","removeLines","templateObject_9","codeSelectedCommandHandler","codeInlineCommandHandler","includes","boldCommandHandler","boldSyntax","italicCommandHandler","italicSyntax","createHeadlineCommandHandler","level","line","replace","orderedListCommandHandler","unorderedListCommandHandler","unorderedListSyntax","blockQuotesCommandHandler","strikeThroughCommandHandler"],"mappings":"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","sourcesContent":["var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n    return cooked;\n};\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { clamp, escapeRegExp, getClipboardText } from \"./utils\";\nimport { Cursor } from \"./Cursor\";\n// eslint-disable-next-line no-useless-escape\nvar ANY_URL_RE = /(https?|ftp):\\/\\/(-\\.)?([^\\s/?\\.#-]+\\.?)+(\\/[^\\s]*)?$/i;\nvar ANY_LIST_RE = /^(\\s*(-|\\*|(\\d\\.){1,2})\\s+)(.+)/;\nvar ANY_BLANK_LIST_RE = /^(\\s*(-|\\*|(\\d\\.){1,2})\\s{0,1})$/;\nvar INDENT_SPACE_SIZE = 4;\nexport var mapCurrentLine = function (element, mapper) {\n    var cursor = new Cursor(element);\n    var currentLine = cursor.getLine();\n    var mappedLine = mapper(currentLine);\n    cursor.spliceContent(Cursor.raw(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\", \"\", \"\"], [\"\", \"\", \"\"])), mappedLine, Cursor.$), { replaceCount: 1 });\n};\n/**\n * Wraps the current selection in markup within the current line\n * or removes markup if target is already wrapped (with useUnwrapping = true)\n */\nexport var singleLineWrapper = function (_a) {\n    var element = _a.element, markup = _a.markup, _b = _a.useUnwrapping, useUnwrapping = _b === void 0 ? true : _b, _c = _a.placeholder, placeholder = _c === void 0 ? \"\" : _c;\n    var cursor = new Cursor(element);\n    var position = cursor.getCurrentPosition();\n    var selected = cursor.getSelected().split(\"\\n\")[0];\n    var currentLine = cursor.getLine();\n    if (!selected) {\n        var before_1 = currentLine.slice(0, position.lineSelectionStart);\n        var after_1 = currentLine.slice(position.lineSelectionStart);\n        var raw_1 = Cursor.raw(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"])), before_1, markup, Cursor.$, placeholder, Cursor.$, markup, after_1);\n        cursor.spliceContent(raw_1, { replaceCount: 1 });\n        return;\n    }\n    var clumpLine = function (value) { return clamp(value, 0, currentLine.length); };\n    var start = position.lineSelectionStart;\n    var end = position.lineSelectionEnd;\n    var needUnwrap = useUnwrapping && currentLine && isTargetAlreadyWrapped(element, markup);\n    var before = currentLine.slice(0, clumpLine(start + (needUnwrap ? -markup.length : 0)));\n    var after = currentLine.slice(clumpLine(end + (needUnwrap ? markup.length : 0)));\n    var onDemandMarkup = needUnwrap ? \"\" : markup;\n    var content = selected || placeholder;\n    var raw = Cursor.raw(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"])), before, onDemandMarkup, Cursor.$, content, Cursor.$, onDemandMarkup, after);\n    cursor.spliceContent(raw, { replaceCount: 1 });\n};\nexport var linkCommandHandler = function (ctx) {\n    // Create a cursor instance it will be the our\n    // core-service for manipulations with textarea\n    var cursor = new Cursor(ctx.element);\n    // Getting range of selection for current line\n    var _a = cursor.getCurrentPosition(), lineSelectionStart = _a.lineSelectionStart, lineSelectionEnd = _a.lineSelectionEnd;\n    // Getting the current line\n    var currentLine = cursor.getLine();\n    // Getting the current selected text\n    var selected = currentLine.slice(lineSelectionStart, lineSelectionEnd);\n    // Slice text before and after selection\n    var after = currentLine.slice(0, lineSelectionStart);\n    var before = currentLine.slice(lineSelectionEnd);\n    var linkPlaceholder = \"example\";\n    var urlPlaceholder = \"url\";\n    var linkText = selected || linkPlaceholder;\n    // Now we can build text for current line. in this tagged bellow template just a\n    // bunch of concatenated strings except \"Cursor.$\" - it is a special marker for\n    // showing selection range declarative, in this case we want to select the \"linkText\"\n    var raw = Cursor.raw(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"], [\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"])), before, Cursor.$, linkText, Cursor.$, urlPlaceholder, after);\n    // Finally we can make \"spliceContent\" - this function receive \"raw\" result and\n    // options object, where you can specify start lineNumber and how many lines\n    // you need to replace (similar to Array.prototype.splice mechanic)\n    // in this case we need to start from current line (default) and replace 1 line\n    // which means just replace the current line\n    cursor.spliceContent(raw, { replaceCount: 1 });\n    // -------------------------------------- PS ----------------------------------------\n    // You can use one or two \"Cursor.$\". One will show the position of the cursor\n    // with two you specify a selection range\n    // ----------------------------------------------------------------------------------\n};\n/**\n * Checks if target is wrapped in markup\n */\nvar isTargetAlreadyWrapped = function (element, markup) {\n    var cursor = new Cursor(element);\n    var currentLine = cursor.getLine();\n    var position = cursor.getCurrentPosition();\n    var clumpLine = function (value) { return clamp(value, 0, currentLine.length); };\n    var escapedMarkup = escapeRegExp(markup);\n    var offsettedTarget = currentLine.slice(clumpLine(position.lineSelectionStart - markup.length), clumpLine(position.lineSelectionEnd + markup.length));\n    var re = new RegExp(escapedMarkup + \".+\" + escapedMarkup, \"gi\");\n    return re.test(offsettedTarget);\n};\nexport var nextLineCommandHandler = function (ctx) {\n    var cursor = new Cursor(ctx.element);\n    var insertListPrefixOnDemand = function () {\n        var position = cursor.getCurrentPosition();\n        var prevLine = cursor.getLine(position.lineNumber - 1) || \"\";\n        var currentLine = cursor.getLine();\n        var listMatch = ANY_LIST_RE.exec(prevLine);\n        if (listMatch === null) {\n            return;\n        }\n        var prefix = listMatch[2];\n        var getNewLinePrefix = function () {\n            var increaseOrder = function () {\n                var splited = prefix.split(\".\");\n                splited[splited.length - 2] = String(parseInt(splited[splited.length - 2]) + 1);\n                return splited.join(\".\");\n            };\n            return (isNaN(parseFloat(prefix)) ? prefix : increaseOrder()).trimStart();\n        };\n        var indent = \" \".repeat(cursor.getIndentSize(position.lineNumber - 1));\n        var raw = Cursor.raw(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\", \"\", \" \", \"\", \"\"], [\"\", \"\", \" \", \"\", \"\"])), indent, getNewLinePrefix(), currentLine, Cursor.$);\n        cursor.spliceContent(raw, {\n            startLineNumber: position.lineNumber,\n            replaceCount: 1,\n        });\n    };\n    // waiting enter default behaver will be handled\n    setTimeout(insertListPrefixOnDemand, 0);\n};\nexport var indentCommandHandler = function (_a) {\n    var element = _a.element, keyEvent = _a.keyEvent, options = _a.options;\n    var cursor = new Cursor(element);\n    keyEvent === null || keyEvent === void 0 ? void 0 : keyEvent.preventDefault();\n    var currentLine = cursor.getLine();\n    var listMatch = ANY_BLANK_LIST_RE.exec(currentLine);\n    var indent = \" \".repeat(INDENT_SPACE_SIZE + cursor.getIndentSize());\n    if (options.useIndentListPrefixTabulation && listMatch) {\n        var prefix = listMatch[2];\n        var newPrefix = !isNaN(parseFloat(prefix)) && prefix.split(\".\").length <= 2 ? prefix + \"1.\" : prefix;\n        cursor.spliceContent(Cursor.raw(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\", \"\", \" \", \"\"], [\"\", \"\", \" \", \"\"])), indent, newPrefix, Cursor.$), { replaceCount: 1 });\n        return;\n    }\n    cursor.spliceContent(Cursor.raw(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\", \"\", \"\", \"\"], [\"\", \"\", \"\", \"\"])), currentLine, indent, Cursor.$), { replaceCount: 1 });\n};\nexport var linkPasteCommandHandler = function (ctx) { return __awaiter(void 0, void 0, void 0, function () {\n    var cursor, position, currentLine, isSelectedUrl, selected, isSelectedInLinkMarkup, pastedValue, before, after, raw;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0:\n                cursor = new Cursor(ctx.element);\n                position = cursor.getCurrentPosition();\n                currentLine = cursor.getLine(position.lineNumber);\n                isSelectedUrl = ANY_URL_RE.test(currentLine.slice(position.lineSelectionStart, position.lineSelectionEnd));\n                selected = cursor.getSelected();\n                isSelectedInLinkMarkup = (function () {\n                    var before = currentLine.slice(0, position.lineSelectionStart);\n                    var after = currentLine.slice(position.lineSelectionEnd);\n                    return /\\[.*\\]\\($/gi.test(before) && /^\\)/gi.test(after);\n                })();\n                if (!selected || !ctx.options.useLinkMarkupOnSelectionPasteUrl || isSelectedInLinkMarkup || isSelectedUrl) {\n                    return [2 /*return*/];\n                }\n                return [4 /*yield*/, getClipboardText().then(function (x) { return x === null || x === void 0 ? void 0 : x.trim(); })];\n            case 1:\n                pastedValue = _a.sent();\n                if (!pastedValue || !ANY_URL_RE.test(pastedValue)) {\n                    return [2 /*return*/];\n                }\n                before = currentLine.slice(0, position.lineSelectionStart);\n                after = currentLine.slice(position.lineSelectionEnd);\n                raw = Cursor.raw(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"], [\"\", \"[\", \"\", \"\", \"](\", \")\", \"\"])), before, Cursor.$, selected, Cursor.$, pastedValue, after);\n                cursor.spliceContent(raw, { replaceCount: 1 });\n                return [2 /*return*/];\n        }\n    });\n}); };\nexport var codeBlockCommandHandler = function (ctx) {\n    var cursor = new Cursor(ctx.element);\n    var position = cursor.getCurrentPosition();\n    var selected = cursor.getSelected();\n    var currentLine = cursor.getLine();\n    var markup = \"```\";\n    var isAlreadyWrapper = function () {\n        var beforeLine = cursor.getLine(position.lineNumber - 1);\n        var afterLine = cursor.getLine(position.lineNumberEnd + 1);\n        return selected && beforeLine === markup && afterLine === markup;\n    };\n    if (isAlreadyWrapper()) {\n        cursor.removeLines(position.lineNumber - 1, position.lineNumberEnd + 1);\n        return;\n    }\n    var prefix = currentLine && !selected ? \"\\n\" : \"\";\n    var content = selected || \"code block\";\n    var raw = Cursor.raw(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"\", \"\", \"\\n\", \"\", \"\", \"\\n\", \"\"], [\"\", \"\", \"\\\\n\", \"\", \"\", \"\\\\n\", \"\"])), prefix, markup, Cursor.$, content, Cursor.$, markup);\n    cursor.spliceContent(raw, {\n        replaceCount: selected.split(\"\\n\").length,\n        startLineNumber: position.lineNumber,\n    });\n};\nexport var codeSelectedCommandHandler = function (ctx) {\n    var cursor = new Cursor(ctx.element);\n    var selected = cursor.getSelected();\n    if (selected === \"\") {\n        codeInlineCommandHandler(ctx);\n        return;\n    }\n    if (selected.includes(\"\\n\")) {\n        codeBlockCommandHandler(ctx);\n    }\n    else {\n        codeInlineCommandHandler(ctx);\n    }\n};\nexport var boldCommandHandler = function (ctx) {\n    singleLineWrapper(__assign(__assign({}, ctx), { placeholder: \"bold\", markup: ctx.options.boldSyntax }));\n};\nexport var italicCommandHandler = function (ctx) {\n    singleLineWrapper(__assign(__assign({}, ctx), { placeholder: \"italic\", markup: ctx.options.italicSyntax }));\n};\nexport var createHeadlineCommandHandler = function (level) { return function (ctx) {\n    var prefix = \"#\".repeat(clamp(level, 1, 6)) + \" \";\n    mapCurrentLine(ctx.element, function (line) { return prefix + line.replace(/^#{0,6}\\s+/g, \"\"); });\n}; };\nexport var orderedListCommandHandler = function (ctx) {\n    mapCurrentLine(ctx.element, function (line) { return \"1. \" + line; });\n};\nexport var unorderedListCommandHandler = function (ctx) {\n    mapCurrentLine(ctx.element, function (line) { return ctx.options.unorderedListSyntax + \" \" + line; });\n};\nexport var blockQuotesCommandHandler = function (ctx) {\n    mapCurrentLine(ctx.element, function (line) { return \"> \" + line; });\n};\nexport var codeInlineCommandHandler = function (ctx) {\n    singleLineWrapper(__assign(__assign({}, ctx), { placeholder: \"code\", markup: \"`\" }));\n};\nexport var strikeThroughCommandHandler = function (ctx) {\n    singleLineWrapper(__assign(__assign({}, ctx), { placeholder: \"strike-through\", markup: \"~~\" }));\n};\nvar templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9;\n"]},"metadata":{},"sourceType":"module"}